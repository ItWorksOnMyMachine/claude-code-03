{
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "Microsoft.Hosting.Lifetime": "Information",
        "Microsoft.EntityFrameworkCore": "Warning",
        "Duende": "Information"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "/var/log/authservice/auth-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 30,
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
        }
      }
    ],
    "Enrich": [ "FromLogContext", "WithMachineName", "WithEnvironmentName", "WithThreadId" ]
  },
  "ConnectionStrings": {
    "DefaultConnection": "Host=${DB_HOST};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USER};Password=${DB_PASSWORD};SSL Mode=Require;Trust Server Certificate=true"
  },
  "IdentityServer": {
    "IssuerUri": "https://auth.platform.com",
    "SigningCertificate": {
      "Type": "File",
      "FilePath": "/app/certs/signing-certificate.pfx",
      "Password": "${CERT_PASSWORD}"
    },
    "TokenCleanup": {
      "EnableTokenCleanup": true,
      "TokenCleanupInterval": 3600,
      "TokenCleanupBatchSize": 100
    },
    "Caching": {
      "ClientStoreExpiration": 3600,
      "ResourceStoreExpiration": 3600,
      "CorsExpiration": 3600
    }
  },
  "Identity": {
    "Password": {
      "RequiredLength": 12,
      "RequireDigit": true,
      "RequireUppercase": true,
      "RequireLowercase": true,
      "RequireNonAlphanumeric": true,
      "RequiredUniqueChars": 6
    },
    "User": {
      "RequireUniqueEmail": true,
      "AllowedUserNameCharacters": "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._@+"
    },
    "SignIn": {
      "RequireConfirmedEmail": true,
      "RequireConfirmedPhoneNumber": false,
      "RequireConfirmedAccount": true
    },
    "Lockout": {
      "DefaultLockoutTimeSpan": "00:15:00",
      "MaxFailedAccessAttempts": 5,
      "AllowedForNewUsers": true
    },
    "Tokens": {
      "EmailConfirmationTokenProvider": "Default",
      "PasswordResetTokenProvider": "Default",
      "ChangeEmailTokenProvider": "Default",
      "ChangePhoneNumberTokenProvider": "Default",
      "AuthenticatorTokenProvider": "Default"
    }
  },
  "Cors": {
    "ProductionOrigins": [
      "https://platform.com",
      "https://www.platform.com",
      "https://app.platform.com",
      "https://api.platform.com",
      "https://admin.platform.com"
    ]
  },
  "RateLimiting": {
    "Enabled": true,
    "PermitLimit": 100,
    "Window": "00:01:00",
    "QueueProcessingOrder": "OldestFirst",
    "QueueLimit": 50,
    "IpWhitelist": [ ],
    "EndpointRules": {
      "/connect/token": {
        "PermitLimit": 20,
        "Window": "00:01:00"
      },
      "/Account/Login": {
        "PermitLimit": 10,
        "Window": "00:05:00"
      },
      "/api/admin/*": {
        "PermitLimit": 60,
        "Window": "00:01:00"
      }
    }
  },
  "SecurityHeaders": {
    "ContentSecurityPolicy": "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'",
    "XContentTypeOptions": "nosniff",
    "XFrameOptions": "DENY",
    "XXssProtection": "1; mode=block",
    "ReferrerPolicy": "strict-origin-when-cross-origin",
    "PermissionsPolicy": "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()",
    "StrictTransportSecurity": {
      "MaxAge": "31536000",
      "IncludeSubDomains": true,
      "Preload": true
    }
  },
  "Redis": {
    "Configuration": "${REDIS_CONNECTION}",
    "InstanceName": "AuthService",
    "ConnectTimeout": 5000,
    "SyncTimeout": 5000,
    "AbortOnConnectFail": false,
    "KeepAlive": 180,
    "ConnectRetry": 3
  },
  "PasswordHistory": {
    "Enabled": true,
    "HistoryCount": 12,
    "MinimumAge": "1.00:00:00"
  },
  "Lockout": {
    "Progressive": true,
    "BaseLockoutMinutes": 5,
    "LockoutMultiplier": 2,
    "MaxLockoutMinutes": 1440,
    "ResetCounterAfterDays": 30
  },
  "Session": {
    "IdleTimeout": "00:20:00",
    "AbsoluteTimeout": "12:00:00",
    "SlidingExpiration": true,
    "RegenerateId": true,
    "ConcurrentSessions": {
      "MaxPerUser": 10,
      "WarnAt": 5
    }
  },
  "Email": {
    "Provider": "SendGrid",
    "ApiKey": "${SENDGRID_API_KEY}",
    "FromAddress": "noreply@platform.com",
    "FromName": "Platform Authentication"
  },
  "Monitoring": {
    "HealthChecks": {
      "DatabaseTimeout": "00:00:30",
      "RedisTimeout": "00:00:10"
    },
    "Metrics": {
      "Enabled": true,
      "Endpoint": "/metrics",
      "IncludeOpenTelemetry": true
    },
    "Tracing": {
      "Enabled": true,
      "ServiceName": "AuthService",
      "ExporterEndpoint": "${OTEL_EXPORTER_OTLP_ENDPOINT}",
      "SamplingRatio": 0.1
    }
  },
  "FeatureFlags": {
    "EnableMfa": true,
    "EnablePasswordlessLogin": false,
    "EnableSocialLogins": false,
    "EnableApiKeyAuthentication": true,
    "EnableDeviceFlow": false,
    "RequireEmailVerification": true,
    "EnableAccountRecovery": true,
    "EnableSessionManagement": true,
    "EnableAuditLogging": true
  },
  "TokenSettings": {
    "AccessTokenLifetime": 300,
    "IdentityTokenLifetime": 300,
    "RefreshTokenLifetime": 2592000,
    "RefreshTokenUsage": "OneTime",
    "RefreshTokenExpiration": "Sliding",
    "UpdateAccessTokenClaimsOnRefresh": true,
    "IncludeJwtId": true,
    "AlwaysIncludeUserClaimsInIdToken": true
  },
  "AllowedHosts": "auth.platform.com"
}